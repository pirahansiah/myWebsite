<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 1. Meta Tags & SEO -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title | default: site.title }}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 }}">
    
    <!-- 2. Security & Verification -->
    <meta name="google-adsense-account" content="ca-pub-7548808026663917">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">

    <!-- 3. Google Consent Mode (FORCE ANALYTICS ON) -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}

      // CRITICAL FIX: We set 'analytics_storage' to 'granted' 
      // This forces Analytics to work even if the AdSense banner is broken.
      gtag('consent', 'default', {
        'ad_storage': 'denied',         // Keep Ads blocked (Required by AdSense Policy)
        'ad_user_data': 'denied',       // Keep User Data blocked
        'ad_personalization': 'denied', // Keep Personalization blocked
        'analytics_storage': 'granted', // <--- THIS TURNS ON ANALYTICS
        'wait_for_update': 500
      });
    </script>

    <!-- 4. Google AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7548808026663917"
     crossorigin="anonymous"></script>

    <!-- 5. Google Analytics 4 Script -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2L49VVJP3B"></script>
    <script>
      gtag('js', new Date());
      gtag('config', 'G-2L49VVJP3B');
    </script>

    <style>
        /* Your Navigation & Layout CSS */
        body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; color: #333; }
        nav { background-color: #333; font-family: Arial, sans-serif; }
        nav ul { list-style-type: none; margin: 0; padding: 0; position: relative; }
        nav ul li { position: relative; display: inline-block; }
        nav ul li a, nav ul li span { display: block; color: white; padding: 14px 20px; text-decoration: none; cursor: pointer; }
        nav ul li a:hover, nav ul li span:hover { background-color: #111; }
        nav ul li ul { display: none; position: absolute; background-color: #333; min-width: 160px; z-index: 1000; top: 100%; left: 0; }
        nav ul li:hover > ul { display: block; }
        nav ul li ul li { display: block; }
        nav ul li ul li a, nav ul li ul li span { padding: 12px 16px; }
        nav ul li ul li ul { top: 0; left: 100%; }
        nav ul li span::after { content: " \25BA"; float: right; }
        nav ul li ul li span::after { content: " \25BA"; float: right; }
        nav ul li a::after, nav ul li ul li a::after { content: ""; }
        
        .back-button { background-color: transparent; border: none; color: #007BFF; font-size: 16px; cursor: pointer; padding: 10px; margin: 10px; }
        
        main { padding: 20px; max-width: 1200px; margin: 0 auto; min-height: 60vh; }
        
        footer { margin-top: 20px; padding: 20px; background-color: #f9f9f9; font-size: 12px; line-height: 1.4; text-align: center; border-top: 1px solid #eee; }
        
        @media screen and (max-width: 768px) {
            nav ul li { display: block; border-bottom: 1px solid #444; }
            nav ul li ul { position: static; }
            nav ul li ul li ul { position: static; }
            nav ul li span::after { content: " \25BC"; }
        }
    </style>
</head>
<body>

<header>
    <nav>
        <ul>
            {% for item in site.navigation %}
            <li>
                {% if item.children %}
                    <span>{{ item.title }}</span>
                    <ul>
                        {% for child in item.children %}
                        <li>
                            {% if child.children %}
                                <span>{{ child.title }}</span>
                                <ul>
                                    {% for subchild in child.children %}
                                    <li><a href="{{ subsubchild.url | relative_url }}">{{ subsubchild.title }}</a></li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <a href="{{ child.url | relative_url }}">{{ child.title }}</a>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </nav>
</header>

<main>
    <button onclick="goBack()" class="back-button">← Back</button>
    {{ content }}
</main>

<footer>
    <p>
        © 2024 Dr. Farshid Pirahansiah. All rights reserved.<br>
        <a href="{{ '/privacy.html' | relative_url }}">Privacy Policy</a> | <a href="mailto:info@pirahansiah.com">Contact</a>
    </p>
</footer>

<script>
    function goBack() { 
        if (document.referrer !== "") { window.history.back(); } 
        else { window.location.href = '{{ "/" | relative_url }}'; } 
    }
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() { 
        const dropdownToggles = document.querySelectorAll('nav ul li span'); 
        dropdownToggles.forEach(function(toggle) { 
            toggle.addEventListener('click', function(e) { 
                if (window.innerWidth <= 768) {
                    const submenu = this.nextElementSibling; 
                    if (submenu) { e.preventDefault(); submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block'; }
                }
            }); 
        }); 
    });
</script>

</body>
</html>